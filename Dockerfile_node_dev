FROM node:22.8.0-alpine3.20

# コンテナ内の作業ディレクトリを作成・設定
WORKDIR /app

# 依存関係のファイルを先にコピーして、Dockerのキャッシュを有効活用する
# これにより、コードの変更だけでは `npm install` が再実行されなくなる
COPY roulette-app/package.json ./
COPY roulette-app/package-lock.json ./

# 依存関係をインストール
# Alpineではビルドツールが必要になる場合があるため、--no-optional をつけると安定することがある
RUN npm install

# アプリケーションのソースコードをコピー
COPY . .

# Next.jsはデフォルトで3000番ポートを使用する
EXPOSE 3000

# コンテナ起動時に実行するデフォルトコマンド
# 開発モードでNext.jsを起動する
CMD ["npm", "run", "dev"]